<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="/css/contactForm.css">
  <title>Create Client</title>
</head>
<body>
  <!-- Logo -->
  <div id="logo-container">
    <img src="/img/Binary.png" alt="Logo" id="logo">
  </div>

  <!-- Tabs for different sections -->
  <div>
    <button onclick="openTab('general')">General</button>
    <button onclick="openTab('contacts')" class="contacts">Contact(s)</button>
  </div>
  
  <!-- ... your existing HTML ... -->

<div id="general" class="tabcontent">
  <form action="/contacts/new" method="POST">
    <!-- Display error messages -->
    

    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>

    <label for="surname">Surname:</label>
    <input type="text" id="surname" name="surname" required>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    <div id="errorMessages" style="display: none; color: red;"></div>

    <button type="submit">Save Contact</button>
  </form>
</div>

<!-- ... your existing script ... -->


  <!-- Contacts tab -->
  <div id="contacts" class="tabcontent">
    <!-- Logic for displaying linked contacts -->
    <ul>
      <% if (client && client.length > 0) { %>
        <li>Linked Contacts:</li>
        <% client.forEach(client => { %>
          <!-- Assuming you have a link like this in clientForm.ejs -->
          <a href="#" class="unlink" data-client-id="<%= client._id %>" data-contact-id="<%= contact._id %>">Unlink</a>
        <% }); %>
      <% } else { %>
        <li>No linked contacts.</li>
      <% } %>
    </ul>

    <!-- Logic for displaying available contacts to link -->
    <ul>
      <li>Available Contacts:</li>
      <% contact.forEach(contact => { %>
        <li>
          <%= contact.name %> (<%= contact.email %>) 
          <a href="#" class="link" data-client-id="<%= client._id %>" data-contact-id="<%= contact._id %>">Link</a>
        </li>
      <% }); %>
    </ul>
  </div>

  <!-- Include script for handling tab switching -->
  <script>
    function openTab(tabName) {
      var i, tabcontent;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      document.getElementById(tabName).style.display = "block";
    }
  </script>
 
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // ... (your existing tab switching script)
  
// AJAX linking logic
$('.link').on('click', function (event) {
      event.preventDefault();
      const clientId = $(this).data('client-id');
      const contactId = $(this).data('contact-id');

      $.ajax({
        url: `/clients/new/link/${clientId}/${contactId}`,
        method: 'GET',
        success: function (data) {
          console.log(data); // Log the response, you can handle it as needed
          // Reload the page or update the UI as necessary
          location.reload();
        },
        error: function (error) {
          console.error('Error:', error);
        }
      });
    });

// AJAX form validation logic
$('#general form').on('submit', function (event) {
  event.preventDefault();

  // Get form data
  const formData = {
    name: $('#name').val(),
    surname: $('#surname').val(),
    email: $('#email').val(),
  };

  // Send AJAX request to the backend for validation
  $.ajax({
  url: '/contacts/new',
  method: 'POST',
  data: formData,
  success: function (data) {
    $('#errorMessages').text(data.error || data.success).css('color', data.error ? 'red' : 'green').show();
    if (!data.error) {
      // Redirect to contact view on success
      window.location.href = '/contacts';
    }
  },
  
  error: function (xhr) {
    // Handle error response
    const responseData = JSON.parse(xhr.responseText);
    $('#errorMessages').text(responseData.error).show();
  }
});

});
    });
</script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
</html>
